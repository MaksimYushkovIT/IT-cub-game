{% extends 'main/base.html' %}

{% block title %}Управление постами и новостями{% endblock %}

{% block content %}
<div class="container">
    <h1>{% if post %}Редактирование поста{% else %}Создание нового поста{% endif %}</h1>
    <form id="post-form">
        <div class="mb-3">
            <label for="title" class="form-label">Название поста</label>
            <input type="text" class="form-control" id="title" name="title" required value="{{ post.title if post else '' }}">
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Описание</label>
            <textarea class="form-control" id="description" name="description" rows="3" required>{{ post.description if post else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="cover_image" class="form-label">Ссылка на фото обложки</label>
            <input type="url" class="form-control" id="cover_image" name="cover_image" required value="{{ post.cover_image if post else '' }}">
        </div>
        <div class="mb-3">
            <label for="content" class="form-label">Содержимое поста</label>
            <textarea class="form-control" id="content" name="content" rows="5" required>{{ post.content if post else '' }}</textarea>
        </div>
        <input type="hidden" id="post_id" value="{{ post.id if post else '' }}">
        <button type="submit" class="btn btn-primary">{% if post %}Обновить пост{% else %}Создать пост{% endif %}</button>
    </form>
</div>

<script>
document.getElementById('post-form').addEventListener('submit', function(event) {
    event.preventDefault(); // Предотвращаем стандартное поведение формы

    const postId = document.getElementById('post_id').value;
    const url = postId ? `/post/${postId}` : '/post'; // URL для создания или обновления
    const method = postId ? 'PUT' : 'POST'; // Метод для создания или обновления

    const formData = {
        title: document.getElementById('title').value,
        description: document.getElementById('description').value,
        cover_image: document.getElementById('cover_image').value,
        content: document.getElementById('content').value,
        author: "Имя автора"  // Замените на реальное имя автора или получите его от пользователя
    };

    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Ошибка при сохранении поста');
        }
        return response.json();
    })
    .then(data => {
        alert(data.message);
        window.location.href = '/posts'; // Перенаправляем на страницу со списком постов
    })
    .catch(error => {
        console.error('Ошибка:', error);
        alert('Не удалось сохранить пост. Пожалуйста, попробуйте еще раз.');
    });
});
</script>
{% endblock %}
